---
title: "[MLOps κΈ°μ΄] DVC(Data Version Control) - PART4. Experiments"
date: 2020-09-23
permalink: /dev/post15
tags : data-science MLOps
categories: machine-learning
---


<br>

[PART3 λ°μ΄ν„° νμ΄ν”„λΌμΈ](https://heainlee.github.io/dev/post14)μ— μ΄μ–΄μ„β€¦ 


## μ‹¤ν— (Experiments)

 
- **Collecting metrics**

> `dvc run`μ„ ν†µν•΄ λ¨λΈ ν‰κ°€ μ¤ν¬λ¦½νΈλ¥Ό μ‹¤ν–‰μ‹ν‚¨λ‹¤

```bash
# νν† λ¦¬μ–Ό λ¦¬λ·° - λ¨λΈ ν‰κ°€
dvc run -n evaluate \
        -d src/evaluate.py -d model.pkl -d data/features \
        -M scores.json \ #  Declare output metric file
        --plots-no-cache prc.json \ # Declare output plot file
        python src/evaluate.py model.pkl \
               data/features scores.json prc.json
-----------------------[output]-----------------------
Running stage 'evaluate' with command:                                
    python src/evaluate.py model.pkl data/features scores.json prc.json
Adding stage 'evaluate' in 'dvc.yaml'                                 
Updating lock file 'dvc.lock'

To track the changes with git, run:

    git add dvc.lock dvc.yaml
------------------------------------------------------
```
---

- **Defining parameters**

> νλΌλ―Έν„°λ¥Ό μ§€μ •ν•λ” λ°©λ²• β†’ params.yaml κ°™μ€ config νμΌ μ‚¬μ© (yaml, json, toml ν¬λ§·)  

`dvc.yaml` νμΌ λ” μ•μ•„λ³΄κΈ° : [DVC Files and Directories](https://dvc.org/doc/user-guide/dvc-files-and-directories#dvcyaml-file)

---

- **Tuning and running experiments**

> λ¨λΈ ν‰κ°€κΉμ§€ μ¶”κ°€λ νμ΄ν”„λΌμΈμ„ λ§λ“¤μ—λ”λ°, score κ²°κ³Ό ν–¥μƒμ„ μ„ν•΄ νλΌλ―Έν„°λ¥Ό λ°”κΎΈλ” λ“±μ μ—¬λ¬κ°€μ§€ μ‹¤ν—μ„ λ” ν•΄λ³΄κ³  μ‹¶μ„ μ μλ‹¤. params.yaml νμΌμ„ μμ •ν•΄μ„ νλΌλ―Έν„°λ¥Ό λ°”κΎΌ ν›„ `dvc repo` λ…λ Ήμ–΄λ΅ νμ΄ν”„λΌμΈμ„ μ¬μ‹¤ν–‰ν•΄λ³΄μ.

```bash
# params.yaml νμΌμ—μ„ μΌλ¶€ νλΌλ―Έν„° μμ •
vim params.yaml
--------[output]----------
featurize:
-  max_features: 500
-  ngrams: 1
+  max_features: 1500
+  ngrams: 2
--------------------------

# λ³€κ²½λ μ‚¬ν•­ ν™•μΈ
dvc status
------------------------[output]----------------------
featurize:
    changed deps:
        params.yaml:
            modified:           featurize.max_features
            modified:           featurize.ngrams
------------------------------------------------------

# λ³€κ²½λ μ‚¬ν•­ λ°μν•μ—¬ μ¬μ‹¤ν–‰
dvc repro
------------------------[output]----------------------------
'data/data.xml.dvc' didn't change, skipping                           
Running stage 'prepare' with command:
    python src/prepare.py data/data.xml
Updating lock file 'dvc.lock'                                                                                                                                                                           

Running stage 'featurize' with command:
    python src/featurization.py data/prepared data/features
The input data frame data/prepared/train.tsv size is (20017, 3)
The output matrix data/features/train.pkl size is (20017, 1502) and data type is float64
The input data frame data/prepared/test.tsv size is (4983, 3)
The output matrix data/features/test.pkl size is (4983, 1502) and data type is float64
Updating lock file 'dvc.lock'                                                                                                                                                                           

Running stage 'train' with command:
    python src/train.py data/features model.pkl
Input matrix size (20017, 1502)
X matrix size (20017, 1500)
Y matrix size (20017,)
Updating lock file 'dvc.lock'                                         

Running stage 'evaluate' with command:
    python src/evaluate.py model.pkl data/features scores.json prc.json
Updating lock file 'dvc.lock'                                         

To track the changes with git, run:

    git add dvc.lock
------------------------------------------------------------
```

---

- **Comparing experiments**

> νλΌλ―Έν„°λ¥Ό λ³€κ²½ν•κΈ° μ „/ν›„ λΉ„κµν•κΈ° μ„ν• λ…λ Ήμ–΄ `params` `metrics` `plots` λ¥Ό κ°κ° μ‹¤ν–‰ν•λ‹¤.

```bash
dvc params diff
dvc metrics diff
dvc plots diff
```
---

ννΈ 1~4μ— λ‚λ„μ–΄μ„ DVC μ£Όμ” κΈ°λ¥κ³Ό μ‚¬μ©λ²•μ— λ€ν•΄ μ•μ•„λ΄¤λ‹¤. <br>
μ΄μ  μ‹¤μ  λ°μ΄ν„° λ¶„μ„ ν”„λ΅μ νΈμ—μ„ μ–Όλ§λ‚ μ μ©ν•μ§€ μ‚¬μ©ν•΄λ³΄λ©΄μ„ μµν€λ³΄μ! <br>

π‘‰  [DVC μ μ¦μΌ€μ΄μ¤ λ³΄λ¬κ°€κΈ°!](https://dvc.org/doc/use-cases)



